import RPi.GPIO as GPIO
import time
import sys, os


powerbutton = 22
GPIO.setmode(GPIO.BCM)
GPIO.setwarnings(False)
GPIO.setup(powerbutton, GPIO.IN, pull_up_down=GPIO.PUD_DOWN)

def main():
	GPIO.add_event_detect(powerbutton, GPIO.FALLING, bouncetime=500)

	while True:
		try:
			if GPIO.event_detected(powerbutton):
				print "Shutdown?"
				if GPIO.input(powerbutton):
					print "Shutdown Aborted"
				else:
					powerOff()
					break
		

		except KeyboardInterrupt:
			GPIO.cleanup()
			print "Done!"
			break
	GPIO.cleanup()


def powerOff():
	print "Begin Shutdown"
	GPIO.cleanup()
	print "Shutting Down"
#	os.system('sudo shutdown -h now')
if True:
	main()
